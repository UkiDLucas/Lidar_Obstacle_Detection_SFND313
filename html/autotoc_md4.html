<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.16"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Sensor Fusion Udacity ND313 Lidar Obstacle Detection: Sensor Fusion Self-Driving Car Course</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Sensor Fusion Udacity ND313 Lidar Obstacle Detection
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.16 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Sensor Fusion Self-Driving <a class="el" href="struct_car.html">Car</a> Course </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h2><a class="anchor" id="autotoc_md5"></a>
Welcome to the Sensor Fusion course for &lt;a href="https://en.wikipedia.org/wiki/Advanced_driver-assistance_systems"&gt;ADAS&lt;/a&gt; and autonomous driving.</h2>
<p><img src="media/tracking objects.gif" alt="" class="inline"/></p>
<p>In this course we will be talking about sensor fusion, which is the process of <b>taking data from multiple sensors and combining it to give us a better understanding of the world around us</b>. We will mostly be focusing on three sensors, lidar, camera and radar. By the end we will be fusing the data from these sensors to track multiple cars on the road, estimating their positions and speed.</p>
<p>Point Cloud Library (PCL) allows us to <b>divide an unorganized collection of 3D points in order to process the subsections rapidly</b>. When <a class="el" href="struct_lidar.html">Lidar</a> point clouds are <b>combined with camera images, this technique allows us to positively identify objects and provide their distance</b>, while Radar allows us to track their speed.</p>
<p><b><a class="el" href="struct_lidar.html">Lidar</a></b> sensing gives us high resolution data by sending out thousands of laser signals. These lasers bounce off objects, returning to the sensor where we can then determine how far away objects are by timing how long it takes for the signal to return. Also we can tell a little bit about the object that was hit by measuring the intesity of the returned signal. Each laser ray is in the infrared spectrum, and is sent out at many different angles, usually in a 360 degree range. While lidar sensors gives us very high accurate models for the world around us in 3D, they are currently still very expensive, upwards of $60,000 for a standard unit.</p>
<p><b>Radar</b> data is typically very sparse and in a limited range, however it can directly tell us how fast an object is moving in a certain direction. This ability makes radars a very pratical sensor for doing things like cruise control where its important to know how fast the car infront of you is traveling. Radar sensors are also very affordable and common now of days in newer cars.</p>
<p><b>Sensor Fusion</b> by combing lidar's high resolution imaging with radar's ability to measure velocity of objects we can get a better understanding of the surrounding environment than we could using one of the sensors alone.</p>
<h1><a class="anchor" id="autotoc_md6"></a>
Class Progress</h1>
<h2><a class="anchor" id="autotoc_md7"></a>
Wednesday, July 31, 2019</h2>
<p>Total class time spent: start ~40 hours, end ~43 hours.</p>
<ul>
<li>Implemented my own 3D KD Tree</li>
</ul>
<h2><a class="anchor" id="autotoc_md8"></a>
Wednesday, July 31, 2019</h2>
<p>Total class time spent: start ~37 hours, end ~40 hours.</p>
<ul>
<li>Implemented Road Plane separation from the Obstacle Cloud</li>
<li>Bounding Boxes</li>
<li>The project runs well</li>
</ul>
<h2><a class="anchor" id="autotoc_md9"></a>
Tuesday, July 30, 2019</h2>
<p>Total class time spent: start ~36 hours, end ~37 hours.</p>
<h3><a class="anchor" id="autotoc_md10"></a>
"Lidar Final Project"</h3>
<p><a href="https://www.youtube.com/watch?v=lGbHW8SMu24">https://www.youtube.com/watch?v=lGbHW8SMu24</a></p>
<p>In this project you will take everything that you have learned for processing point clouds, and use it to detect car and trucks on a narrow street using lidar. The detection pipeline should follow the covered methods, filtering, segmentation, clustering, and bounding boxes. Also the <b>segmentation, and clustering methods should be created from scratch</b> using the previous lessonâ€™s guidelines for reference.</p>
<ul>
<li>Final project</li>
</ul>
<p><a href="https://www.youtube.com/watch?v=lGbHW8SMu24"><img src="media/ObstacleDetectionFPS.gif" alt="YouTube video" class="inline"/></a></p>
<h2><a class="anchor" id="autotoc_md11"></a>
Monday, July 29, 2019</h2>
<p>Total class time spent: start ~35 hours, end ~36 hours.</p>
<h3><a class="anchor" id="autotoc_md12"></a>
Lesson 4 "Working with Real PCD"</h3>
<ul>
<li>Downsampling/filtering the Point Cloud Data</li>
<li>The streaming point cloud (animation) is working!</li>
</ul>
<h2><a class="anchor" id="autotoc_md13"></a>
Saturday, July 27, 2019</h2>
<p>Total class time spent: start ~34 hours, end ~35 hours.</p>
<h3><a class="anchor" id="autotoc_md14"></a>
Lesson 4 "Working with Real PCD"</h3>
<ul>
<li>Rendring the cloud</li>
</ul>
<p><img src="media/Real PCD 2019-07-27 at 7.22.15 PM.png" alt="" class="inline"/></p>
<h2><a class="anchor" id="autotoc_md15"></a>
Tuesday, July 23, 2019</h2>
<p>Total class time spent: start ~33 hours, end ~34 hours.</p>
<h3><a class="anchor" id="autotoc_md16"></a>
Lesson 4 "Working with Real PCD"</h3>
<ul>
<li>Just started, but it is not rendering</li>
</ul>
<h3><a class="anchor" id="autotoc_md17"></a>
Lesson 3.9 "Bounding Boxes"</h3>
<ul>
<li>Implemented code</li>
</ul>
<p><img src="media/environment 2019-07-23 at 4.25.55 PM.png" alt="" class="inline"/></p>
<h3><a class="anchor" id="autotoc_md18"></a>
Lesson 3.8 "Euclidean pclClustering"</h3>
<ul>
<li>Implemented euclideanCluster and clusterHelper, but it finds 11 clusters for 11 points,</li>
</ul>
<h2><a class="anchor" id="autotoc_md19"></a>
Monday, July 22, 2019</h2>
<p>Total class time spent: start ~31.5 hours, end ~33 hours.</p>
<ul>
<li>Cleaned up searchHelper, the bug is in the way I pass in resultIds:<ul>
<li>std::vector&lt;int&gt;&amp; resultIds - fixed</li>
</ul>
</li>
</ul>
<h2><a class="anchor" id="autotoc_md20"></a>
Sunday, July 21, 2019</h2>
<p>Total class time spent: start ~30 hours, end ~31.5 hours.</p>
<p>Read few articles on Machine Learning on MacOS, CUDA (NVidia) vs OpenCL (AMD) GPU.</p>
<div class="fragment"><div class="line">$ pip install -U plaidml-keras</div>
<div class="line">Requirement already satisfied, skipping upgrade: keras==2.2.4 in /anaconda2/lib/python2.7/site-packages (from plaidml-keras) (2.2.4)</div>
<div class="line">Successfully installed plaidml-0.6.3 plaidml-keras-0.6.3</div>
<div class="line">$ plaidml-setup</div>
</div><!-- fragment --><ul>
<li>Installing <a href="https://vertexai-plaidml.readthedocs-hosted.com/en/latest/index.html">PlaidML</a></li>
</ul>
<p>0815 - 0945</p>
<h3><a class="anchor" id="autotoc_md21"></a>
Lesson 3.7 Searching Points in KD-Tree</h3>
<ul>
<li>fixing bugs</li>
<li>Cleaning and adding documentation to the code</li>
<li>Still getting bad result pclClustering found 0 and took 0 milliseconds</li>
</ul>
<h3><a class="anchor" id="autotoc_md22"></a>
autotoc_md22</h3>
<h2><a class="anchor" id="autotoc_md23"></a>
Saturday, July 20, 2019</h2>
<p>Total class time spent: start ~29.5 hours, end ~30 hours.</p>
<ul>
<li>I have re-read documentation about Euclidean Cluster Extraction: <a href="http://pointclouds.org/documentation/tutorials/cluster_extraction.php">http://pointclouds.org/documentation/tutorials/cluster_extraction.php</a></li>
<li>Added documentation to my project: <a href="https://github.com/UkiDLucas/SFND313_Lidar_Obstacle_Detection#ukis-class-progress">https://github.com/UkiDLucas/SFND313_Lidar_Obstacle_Detection#ukis-class-progress</a></li>
<li>Renamed variables in <a class="el" href="kdtree_8h_source.html">kdtree.h</a> to make code easier to read and understand.</li>
</ul>
<h2><a class="anchor" id="autotoc_md24"></a>
Friday, July 19, 2019</h2>
<p>Total class time spent: ~29.5 hours.</p>
<p><a class="anchor" id="autotoc_md25"></a></p><h5>Bounding Boxes</h5>
<p><img src="media/Bounding Boxes 2019-07-19 at 7.40.46 AM.png" alt="" class="inline"/></p>
<p><a class="anchor" id="autotoc_md26"></a></p><h5>KD Tree</h5>
<p>The KD Tree is used to drastically speed up a look up of points in space.</p>
<p>The KD Tree is a form of binary tree where you sort the e.g. points (X,Y), shown below, you take the median of X from all the points and insert it as a root node, then take median of all Y and insert it as first child, then continue recursively.</p>
<p><img src="media/KD Tree 2019-07-19 at 8.51.21 AM.png" alt="" class="inline"/></p>
<h2><a class="anchor" id="autotoc_md27"></a>
Thursday, July 18, 2019</h2>
<p>Total class time spent: ~27 hours.</p>
<p>Today, I was able to implement the first version of RANSAC 3D that fits a plane (e.g. road surface) to a Point Cloud data.</p>
<p><img src="media/RANSAC 3D segmentation 2019-07-18 at 4.03.06 PM.png" alt="" width="800" class="inline"/></p>
<p>Another happy milestone is that I am able to run it in Mac OS without Ubuntu (dual boot, or remote)</p>
<p>You can see that the plane (green dots) upper boundary mixes with obstacles (red dots), the following image is after adjusting iterations to 1,000 and the distance threshold down to 0.05 meters (5 cm).</p>
<p>Happy medium is somewhere in between.</p>
<p><img src="media/RANSAC 3D 2019-07-18 at 4.50.36 PM.png" alt="" class="inline"/></p>
<p><img src="media/RANSAC 3D equations 2019-07-18 at 9.18.01 AM.png" alt="" class="inline"/></p>
<div class="fragment"><div class="line">SFND313_Lidar_Obstacle_Detection/src/quiz/ransac/ $ make clean &amp;&amp; make &amp;&amp; ./quizRansac</div>
</div><!-- fragment --><p><a class="anchor" id="autotoc_md28"></a></p><h5>Applying Euclidean pclClustering and KD Tree</h5>
<p>I am correctly detecting all 3 cars and the road underneath.</p>
<div class="fragment"><div class="line">float clusterTolerance = 1.5; *// e.g. less than 1.5 divides the car in two*</div>
<div class="line">int minClusterSize = 1; *// weed out the single point outliers (i.e. gravel)*</div>
<div class="line">int maxClusterSize = 500; *// my biggest car is 278 points*</div>
</div><!-- fragment --><p><img src="media/pclClustering 2019-07-18 at 5.35.06 PM.png" alt="" class="inline"/></p>
<h1><a class="anchor" id="autotoc_md29"></a>
Further Reading</h1>
<ul>
<li>Euclidean Cluster Extraction: <a href="http://pointclouds.org/documentation/tutorials/cluster_extraction.php">http://pointclouds.org/documentation/tutorials/cluster_extraction.php</a></li>
<li>pcl Namespace Reference: <a href="http://docs.pointclouds.org/1.0.0/namespacepcl.html">http://docs.pointclouds.org/1.0.0/namespacepcl.html</a></li>
<li>Distance between Point and a Line: <a href="https://brilliant.org/wiki/dot-product-distance-between-point-and-a-line/">https://brilliant.org/wiki/dot-product-distance-between-point-and-a-line/</a></li>
<li>Extracting indices from a PointCloud: <a href="http://pointclouds.org/documentation/tutorials/extract_indices.php#extract-indices">http://pointclouds.org/documentation/tutorials/extract_indices.php#extract-indices</a></li>
</ul>
<h1><a class="anchor" id="autotoc_md30"></a>
Installation</h1>
<h3><a class="anchor" id="autotoc_md31"></a>
Ubuntu (Parallels on MacBook Pro, Radeon Pro 560 4 GB)</h3>
<p>See my blog post: <a href="https://ukidlucas.blogspot.com/2019/07/ubuntu-cmake.html">https://ukidlucas.blogspot.com/2019/07/ubuntu-cmake.html</a></p>
<div class="fragment"><div class="line">$&gt; sudo apt install libpcl-dev</div>
<div class="line">$&gt; cd ~</div>
<div class="line">$&gt; git clone https://github.com/udacity/SFND_Lidar_Obstacle_Detection.git</div>
<div class="line">$&gt; cd SFND_Lidar_Obstacle_Detection</div>
<div class="line">$&gt; mkdir build &amp;&amp; cd build</div>
<div class="line">$&gt; cmake ..</div>
<div class="line">$&gt; make</div>
<div class="line">$&gt; ./environment</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md32"></a>
Windows</h3>
<p><a href="http://www.pointclouds.org/downloads/windows.html">http://www.pointclouds.org/downloads/windows.html</a></p>
<h3><a class="anchor" id="autotoc_md33"></a>
MAC</h3>
<h4><a class="anchor" id="autotoc_md34"></a>
Install via Homebrew</h4>
<ol type="1">
<li>install <a href="https://brew.sh/">homebrew</a></li>
<li>update homebrew</li>
</ol>
<div class="fragment"><div class="line">$&gt; brew update</div>
</div><!-- fragment --><ol type="1">
<li>add homebrew science <a href="https://docs.brew.sh/Taps">tap</a></li>
</ol>
<div class="fragment"><div class="line">$&gt; brew tap brewsci/science</div>
</div><!-- fragment --><ol type="1">
<li>view pcl install options</li>
</ol>
<div class="fragment"><div class="line">$&gt; brew options pcl</div>
</div><!-- fragment --><ol type="1">
<li>install PCL</li>
</ol>
<div class="fragment"><div class="line">$&gt; brew install pcl</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md35"></a>
Compilation on MacOS</h2>
<div class="fragment"><div class="line">$ pwd</div>
<div class="line"> </div>
<div class="line">SFND313_Lidar_Obstacle_Detection/build</div>
<div class="line">build $ cmake ../CMakeLists.txt</div>
</div><!-- fragment --><p>Compilation results in ERROR:</p>
<div class="fragment"><div class="line">-- Checking for module &#39;glew&#39;</div>
<div class="line"> </div>
<div class="line">--   No package &#39;glew&#39; found</div>
<div class="line"> </div>
<div class="line">CMake Error at /usr/local/share/pcl-1.9/PCLConfig.cmake:58 (message):</div>
<div class="line"> </div>
<div class="line">  simulation is required but glew was not found</div>
</div><!-- fragment --><p><a class="anchor" id="autotoc_md36"></a></p><h5>FIX for the "missing glew" problem (No package 'glew' found)</h5>
<div class="fragment"><div class="line">build $ cd ..</div>
<div class="line"> </div>
<div class="line">(turi) uki  13:00 SFND313_Lidar_Obstacle_Detection $ edit CMakeCache.txt </div>
</div><!-- fragment --><p>EDIT lines (~279) to look similar to:</p>
<div class="fragment"><div class="line">//GLEW library for OSX</div>
<div class="line">GLEW_GLEW_LIBRARY:STRING=/usr/local/Cellar/glew/2.1.0</div>
<div class="line"> </div>
<div class="line">//GLEW include dir for OSX</div>
<div class="line">GLEW_INCLUDE_DIR:STRING=/usr/local/Cellar/glew/2.1.0</div>
</div><!-- fragment --><div class="fragment"><div class="line">SFND313_Lidar_Obstacle_Detection $ cd build/</div>
<div class="line"> </div>
<div class="line">(turi) uki  13:03 build $ cmake ../CMakeLists.txt</div>
<div class="line"> </div>
<div class="line">...</div>
<div class="line"> </div>
<div class="line">-- Configuring done</div>
<div class="line"> </div>
<div class="line">-- Generating done</div>
<div class="line"> </div>
<div class="line">-- Build files have been written to: /Volumes/DATA/_Drive/_REPOS/SFND313_Lidar_Obstacle_Detection</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">build $ cd ..</div>
<div class="line">(turi) uki  13:09 SFND313_Lidar_Obstacle_Detection $ make clean &amp;&amp; make</div>
</div><!-- fragment --><h4><a class="anchor" id="autotoc_md37"></a>
Prebuilt Binaries via Universal Installer</h4>
<p><a href="http://www.pointclouds.org/downloads/macosx.html">http://www.pointclouds.org/downloads/macosx.html</a> <br  />
NOTE: very old version</p>
<h4><a class="anchor" id="autotoc_md38"></a>
Build from Source</h4>
<p><a href="https://github.com/PointCloudLibrary/pcl">PCL Source Github</a></p>
<p><a href="http://www.pointclouds.org/documentation/tutorials/compiling_pcl_macosx.php">PCL Mac Compilation Docs</a> </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.16
</small></address>
</body>
</html>
